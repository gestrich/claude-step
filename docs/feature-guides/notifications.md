# Notifications Guide

This guide explains how to set up Slack notifications, PR summaries, and statistics reports for visibility into your PR chain's progress.

## Table of Contents

- [Slack Notifications](#slack-notifications)
- [PR Summaries](#pr-summaries)
- [Statistics Reports](#statistics-reports)

---

## Slack Notifications

ClaudeChain can post to Slack when PRs are created, keeping your team informed.

### Getting a Webhook URL

1. Go to [api.slack.com/messaging/webhooks](https://api.slack.com/messaging/webhooks)
2. Click **Create an app** (or select an existing app)
3. Choose **From scratch**, name it (e.g., "ClaudeChain"), select your workspace
4. Go to **Incoming Webhooks** and toggle it on
5. Click **Add New Webhook to Workspace**
6. Select the channel for notifications
7. Copy the webhook URL (looks like `https://hooks.slack.com/services/...`)

### Adding the Secret

1. Go to your repository **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. Click **New repository secret**
3. Name: `SLACK_WEBHOOK_URL`
4. Value: Paste your webhook URL
5. Click **Add secret**

### Enabling in Your Workflow

Pass the webhook URL to the action:

```yaml
- uses: gestrich/claude-chain@main
  with:
    anthropic_api_key: ${{ secrets.CLAUDE_CHAIN_ANTHROPIC_API_KEY }}
    github_token: ${{ github.token }}
    project_name: ${{ github.event.inputs.project_name || '' }}
    slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
```

**Important:** You must pass `slack_webhook_url` as an action input. Simply setting the secret without passing it to the action won't enable notifications.

### What Notifications Include

When a PR is created, Slack receives:
- Project name
- Task description
- Assigned reviewer
- Link to the PR

---

## PR Summaries

ClaudeChain can automatically post AI-generated summary comments on PRs, explaining what changed and why.

### How It Works

After creating a PR, ClaudeChain:
1. Reads the PR diff
2. Sends it to Claude for analysis
3. Posts a summary comment on the PR

### Enabling/Disabling

PR summaries are **enabled by default**. To disable:

```yaml
- uses: gestrich/claude-chain@main
  with:
    anthropic_api_key: ${{ secrets.CLAUDE_CHAIN_ANTHROPIC_API_KEY }}
    github_token: ${{ github.token }}
    add_pr_summary: 'false'  # Disable summaries
```

### What Summaries Include

The summary comment contains:
- Overview of changes made
- Files and functions modified
- How the changes address the task
- Link to the workflow run

Example:
```markdown
## ClaudeChain Summary

Added JWT token generation to the login endpoint. Modified `src/auth/login.ts`
to generate a signed JWT on successful authentication, replacing the previous
session-based approach. Updated the response format to include the token in
the response body.

---
*Generated by ClaudeChain â€¢ [View workflow run](https://github.com/...)*
```

### Cost

Each summary costs approximately **$0.002-0.005** depending on diff size:
- Input: ~500-5000 tokens (varies with diff size)
- Output: ~500 tokens (200 words max)

For high-volume projects, consider disabling if cost is a concern.

---

## Statistics Reports

ClaudeChain provides a statistics action that generates team activity reports.

### Setting Up the Statistics Workflow

Create `.github/workflows/claudechain-statistics.yml`:

```yaml
name: ClaudeChain Statistics

on:
  schedule:
    - cron: '0 9 * * 1'  # Every Monday at 9 AM UTC
  workflow_dispatch:      # Allow manual triggers

permissions:
  contents: read
  actions: read
  pull-requests: read  # Required for listing PRs

jobs:
  statistics:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: gestrich/claude-chain/statistics@main
        with:
          workflow_name: 'ClaudeChain'  # Must match the name: property in your main workflow
          github_token: ${{ github.token }}
          days_back: 7
          slack_webhook_url: ${{ secrets.CLAUDE_CHAIN_SLACK_WEBHOOK_URL }}
```

### Statistics Action Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `workflow_name` | Yes | - | Name of the workflow that creates PRs (must match the `name:` property in your main ClaudeChain workflow) |
| `github_token` | Yes | `${{ github.token }}` | GitHub token for API access |
| `days_back` | No | `30` | Days to look back for statistics |
| `base_branch` | No | `main` | Branch to fetch project specs from |
| `slack_webhook_url` | No | - | Slack webhook for posting reports |
| `config_path` | No | - | Path to specific project config (omit for all projects) |
| `format` | No | `slack` | Output format: `slack` or `json` |
| `show_reviewer_stats` | No | `false` | Show reviewer leaderboard in output |

### What Reports Include

**Project Progress (always shown):**
```
ğŸ“Š Project Progress
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project          â”‚ Open â”‚ Merged â”‚ Total â”‚ Progress        â”‚ Cost  â”‚ Status     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ auth-migration   â”‚    1 â”‚      4 â”‚    10 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  40% â”‚ $0.45 â”‚            â”‚
â”‚ api-cleanup      â”‚    2 â”‚      8 â”‚    15 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  53% â”‚ $0.72 â”‚ âš ï¸ 1 stale â”‚
â”‚ docs-update      â”‚    0 â”‚      3 â”‚    20 â”‚ â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  15% â”‚     - â”‚ âš ï¸ no PRs  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

The **Status** column shows warnings for projects needing attention:
- `âš ï¸ N stale` - Project has N stale PRs (open longer than the configured threshold)
- `âš ï¸ no PRs` - Project has remaining tasks but no open PRs

**Warnings Section (shown when issues exist):**
```
âš ï¸ Projects Needing Attention
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project          â”‚ Issue                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ docs-update      â”‚ No open PRs (17 tasks remaining)              â”‚
â”‚ api-cleanup      â”‚ PR #123 stale (12d, alice)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Team Leaderboard (opt-in with `show_reviewer_stats: true`):**
```
ğŸ† Leaderboard
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rank â”‚ Username â”‚ Open â”‚ Merged â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¥‡   â”‚ alice    â”‚    1 â”‚      5 â”‚
â”‚ ğŸ¥ˆ   â”‚ bob      â”‚    2 â”‚      3 â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

To enable the leaderboard, add `show_reviewer_stats: true` to your workflow:

```yaml
- uses: gestrich/claude-chain/statistics@main
  with:
    workflow_name: 'ClaudeChain'  # Must match the name: property in your main workflow
    github_token: ${{ github.token }}
    show_reviewer_stats: true  # Enable reviewer leaderboard
```

### Scheduling Options

Common cron schedules:

| Schedule | Cron Expression | Description |
|----------|-----------------|-------------|
| Weekly Monday 9am | `0 9 * * 1` | Weekly team summary |
| Daily 9am | `0 9 * * *` | Daily progress check |
| Bi-weekly Friday | `0 17 * * 5` | End of sprint recap |

Adjust the timezone by changing the hour (cron uses UTC).

### Manual Trigger

Run statistics on-demand:

1. Go to **Actions** â†’ **ClaudeChain Statistics**
2. Click **Run workflow**
3. Optionally adjust `days_back`
4. Click **Run workflow**

### Running Locally

For debugging or one-off reports:

```bash
source .venv/bin/activate
python -m claudechain statistics \
  --repo "owner/repo" \
  --days-back 7 \
  --format slack
```

See [API Reference](../feature-architecture/api-reference.md) for full CLI options.

---

## Notification Summary

| Feature | Purpose | Cost | Default |
|---------|---------|------|---------|
| Slack notifications | Alert team when PRs are created | Free | Disabled |
| PR summaries | Explain changes on each PR | ~$0.002-0.005 | Enabled |
| Statistics reports | Team progress and activity | Free | Manual setup |

---

## Next Steps

- [Setup Guide](./setup.md) - Initial ClaudeChain configuration
- [Projects Guide](./projects.md) - Create and configure projects
- [Troubleshooting](./troubleshooting.md) - Common issues and solutions
