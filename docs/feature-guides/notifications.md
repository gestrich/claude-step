# Notifications Guide

This guide explains how to set up Slack notifications, PR summaries, and statistics reports for visibility into ClaudeStep activity.

## Table of Contents

- [Slack Notifications](#slack-notifications)
- [PR Summaries](#pr-summaries)
- [Statistics Reports](#statistics-reports)

---

## Slack Notifications

ClaudeStep can post to Slack when PRs are created, keeping your team informed.

### Getting a Webhook URL

1. Go to [api.slack.com/messaging/webhooks](https://api.slack.com/messaging/webhooks)
2. Click **Create an app** (or select an existing app)
3. Choose **From scratch**, name it (e.g., "ClaudeStep"), select your workspace
4. Go to **Incoming Webhooks** and toggle it on
5. Click **Add New Webhook to Workspace**
6. Select the channel for notifications
7. Copy the webhook URL (looks like `https://hooks.slack.com/services/...`)

### Adding the Secret

1. Go to your repository **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. Click **New repository secret**
3. Name: `SLACK_WEBHOOK_URL`
4. Value: Paste your webhook URL
5. Click **Add secret**

### Enabling in Your Workflow

Pass the webhook URL to the action:

```yaml
- uses: gestrich/claude-step@v2
  with:
    anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
    github_token: ${{ secrets.GITHUB_TOKEN }}
    github_event: ${{ toJson(github.event) }}
    event_name: ${{ github.event_name }}
    project_name: ${{ github.event.inputs.project_name || '' }}
    slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}  # Enable notifications
```

**Important:** You must pass `slack_webhook_url` as an action input. Simply setting the secret without passing it to the action won't enable notifications.

### What Notifications Include

When a PR is created, Slack receives:
- Project name
- Task description
- Assigned reviewer
- Link to the PR

---

## PR Summaries

ClaudeStep can automatically post AI-generated summary comments on PRs, explaining what changed and why.

### How It Works

After creating a PR, ClaudeStep:
1. Reads the PR diff
2. Sends it to Claude for analysis
3. Posts a summary comment on the PR

### Enabling/Disabling

PR summaries are **enabled by default**. To disable:

```yaml
- uses: gestrich/claude-step@v2
  with:
    anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
    github_token: ${{ secrets.GITHUB_TOKEN }}
    add_pr_summary: 'false'  # Disable summaries
```

### What Summaries Include

The summary comment contains:
- Overview of changes made
- Files and functions modified
- How the changes address the task
- Link to the workflow run

Example:
```markdown
## AI-Generated Summary

Added JWT token generation to the login endpoint. Modified `src/auth/login.ts`
to generate a signed JWT on successful authentication, replacing the previous
session-based approach. Updated the response format to include the token in
the response body.

---
*Generated by ClaudeStep â€¢ [View workflow run](https://github.com/...)*
```

### Cost

Each summary costs approximately **$0.002-0.005** depending on diff size:
- Input: ~500-5000 tokens (varies with diff size)
- Output: ~500 tokens (200 words max)

For high-volume projects, consider disabling if cost is a concern.

---

## Statistics Reports

ClaudeStep provides a statistics action that generates team activity reports.

### Setting Up the Statistics Workflow

Create `.github/workflows/claudestep-statistics.yml`:

```yaml
name: ClaudeStep Statistics

on:
  schedule:
    - cron: '0 9 * * 1'  # Every Monday at 9 AM UTC
  workflow_dispatch:      # Allow manual triggers

permissions:
  contents: read
  actions: read

jobs:
  statistics:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: gestrich/claude-step/statistics@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          days_back: 7
          slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
```

### Statistics Action Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `github_token` | Yes | - | GitHub token for API access |
| `days_back` | No | `30` | Days to look back for statistics |
| `base_branch` | No | `main` | Branch to fetch project specs from |
| `slack_webhook_url` | No | - | Slack webhook for posting reports |
| `config_path` | No | - | Path to specific project config (omit for all projects) |
| `format` | No | `slack` | Output format: `slack` or `json` |

### What Reports Include

**Team Leaderboard:**
```
ğŸ† Leaderboard
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rank â”‚ Username â”‚ Open â”‚ Merged â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¥‡   â”‚ alice    â”‚    1 â”‚      5 â”‚
â”‚ ğŸ¥ˆ   â”‚ bob      â”‚    2 â”‚      3 â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Project Progress:**
```
ğŸ“Š Project Progress
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project          â”‚ Open â”‚ Merged â”‚ Total â”‚ Progress        â”‚ Cost  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ auth-migration   â”‚    1 â”‚      4 â”‚    10 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  40% â”‚ $0.45 â”‚
â”‚ api-cleanup      â”‚    2 â”‚      8 â”‚    15 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  53% â”‚ $0.72 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scheduling Options

Common cron schedules:

| Schedule | Cron Expression | Description |
|----------|-----------------|-------------|
| Weekly Monday 9am | `0 9 * * 1` | Weekly team summary |
| Daily 9am | `0 9 * * *` | Daily progress check |
| Bi-weekly Friday | `0 17 * * 5` | End of sprint recap |

Adjust the timezone by changing the hour (cron uses UTC).

### Manual Trigger

Run statistics on-demand:

1. Go to **Actions** â†’ **ClaudeStep Statistics**
2. Click **Run workflow**
3. Optionally adjust `days_back`
4. Click **Run workflow**

### Running Locally

For debugging or one-off reports:

```bash
source .venv/bin/activate
python -m claudestep statistics \
  --repo "owner/repo" \
  --days-back 7 \
  --format slack
```

See [API Reference](../feature-architecture/api-reference.md) for full CLI options.

---

## Notification Summary

| Feature | Purpose | Cost | Default |
|---------|---------|------|---------|
| Slack notifications | Alert team when PRs are created | Free | Disabled |
| PR summaries | Explain changes on each PR | ~$0.002-0.005 | Enabled |
| Statistics reports | Team progress and activity | Free | Manual setup |

---

## Next Steps

- [Setup Guide](./setup.md) - Initial ClaudeStep configuration
- [Projects Guide](./projects.md) - Create and configure projects
- [Troubleshooting](./troubleshooting.md) - Common issues and solutions
