name: ClaudeStep

on:
  workflow_dispatch:
    inputs:
      project_name:
        description: 'Project name in claude-step directory'
        required: true
      base_branch:
        description: 'Base branch for pull requests'
        required: false
        default: 'e2e-test'
      checkout_ref:
        description: 'Branch/ref to checkout (defaults to e2e-test)'
        required: false
        default: 'e2e-test'

permissions:
  contents: write       # Commit and push changes
  pull-requests: write  # Create PRs
  issues: write         # Create labels

jobs:
  run-claudestep:
    runs-on: ubuntu-latest
    env:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.checkout_ref || 'e2e-test' }}

      - name: Run ClaudeStep action
        uses: ./
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          project_name: ${{ github.event.inputs.project_name }}
          base_branch: ${{ github.event.inputs.base_branch || 'e2e-test' }}
          claude_model: 'claude-3-haiku-20240307'
          slack_webhook_url: ${{ env.SLACK_WEBHOOK_URL }}
